  <!-- templates/home.html -->
  <!-- This is the template. It needs to be in the templates folder so that my app can access it. -->

  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <link rel="stylesheet" href="{{url_for('static', filename='styles.css')}}">
      <title>Cooler Contexto</title>
      <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  </head>


  <body>
  
  <div class="flex-container">
    <div>
      <h1>Cooltexto!!!! </h1>
    </div>
 
  <div>
  <form id="makeGuess">
    <input type="text" id="userGuess" placeholder="Type ur guess" required>
    <button type="submit">Guess!</button>
  </form>
</div>

  <div>
  <p id="result" class="guess_result">
  </p>
</div>  
  <script> 
    let startTime = 0 
    let api_url = 'http://localhost:8000/generate'; 
    document.getElementById("result").innerHTML = "Loading game! Please wait.";

    fetch(api_url).then(
      whatever =>{
          document.getElementById("result").innerHTML = "Game loaded! Make your first guess!.";
            startTime = new Date()
      }
    )
     
  </script> 
  <div>
    <h2>
      Guesses!
    </h2>

  </div>
  <div>
  <p id="past_rankings"></p>  
  </div>

  <div id="reveal_playagain">
    <button type = "button" class="centerbuttons" onclick="revealWord()"> Reveal word</button>  </div>

    <p id="secret_word"></p>
  <script>
    
    document.getElementById('makeGuess').addEventListener('submit', function(event) {
      event.preventDefault();  
      
      guessWord(document.getElementById("userGuess").value)
      }); 
  function revealWord(){
    let api_url = 'http://localhost:8000/reveal_word'; 
    fetch(api_url)
    .then(response => response.json())
    .then(data => {document.getElementById("secret_word").textContent = "Secret word: " + data.word})
    document.getElementById("reveal_playagain").innerHTML = '<button type = "button" class="centerbuttons" onclick="hideWord()"> Hide word</button>  </div>'

  }
  function hideWord(){
    document.getElementById("reveal_playagain").innerHTML = '<button type = "button" class="centerbuttons" onclick="revealWord()"> Reveal word</button>  </div>'

  }

  async function guessWord(word){
      let api_url = 'http://localhost:8000/guess'; 
      fetch(api_url, {
          method: 'POST', //tells it its a post
            credentials: 'include',
          headers: {
          'Content-Type': 'application/json', //basically tells it yo im giving u a json give me back a json
          "Accept": "application/json"
          },
      body: JSON.stringify({ guess: word }) //turns it into json format
      })

      .then(response => response.json())
      .then(data => {
        if (data.rank === "not found"){
          document.getElementById('result').textContent = word + " was not found!";
 
        }else if (data.rank == 0){
              const endTime = new Date();
              const timeTaken = ((endTime - startTime) / 1000);
              const minutes = Math.floor(timeTaken / 60).toFixed(2);
              const seconds = (timeTaken % 60).toFixed(2);

            document.getElementById('result').innerHTML=  
              `  <p>Congrats! "${word}" was the secret word! You took ${minutes} minutes and ${seconds} seconds to guess the word!</p> 
                <button type="button" class="centerbuttons" onclick="playAgain()">Play Again!</button>`
            document.getElementById("reveal_playagain").innerHTML=
                            `<button type="button" class="centerbuttons" onclick="playAgain()">Play Again!</button> `

            confetti({
              particleCount: 150,
              spread: 70,
              origin: { y: 0.6 }
            });
        }else if(data.rank == "already guessed"){ 
          document.getElementById('result').textContent =  word + " was already tried!";
        }else{ 
            document.getElementById('result').textContent = word + " was " + data.rank + " away from target!";
        }
        }).then(whatever => {
        fetch('http://localhost:8000/get_previous_guesses').then(response => response.json()).then(jsonned => {
        let prevguesses=jsonned.previous_guesses 
        // previous guesses should be an array
        let newList = "<ol>"
        for(let i = 0; i <prevguesses.length; i++ ){
          newList += "<li>" + prevguesses[i][0] + " which is rank " + prevguesses[i][1]+ "</li> \n" //i know this is terrible but im honestly done fighting html and js
        }
        newList += "</ol>"
        document.getElementById('past_rankings').innerHTML = newList; 
    })}
      ).catch(error => console.error('Error:', error));
 
      }

  function playAgain(){
    let api_url = 'http://localhost:8000/generate'; 
 document.getElementById("past_rankings").innerHTML = "";
    document.getElementById("result").innerHTML = "Loading new game! Please wait.";
    document.getElementById("secret_word").innerHTML = ""; 
    document.getElementById("reveal_playagain").innerHTML = `<button type = "button" class="centerbuttons" onclick="revealWord()"> Reveal word</button>`
    fetch(api_url).then(whatever =>{
    document.getElementById("result").innerHTML = "New game loaded! Make your first guess!";
    startTime = new Date()
      })
  }
  </script>
  </div>
  </body>
  </html>    